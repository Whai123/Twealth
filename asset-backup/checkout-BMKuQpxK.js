import{bD as I,u as P,r as y,a as _,g as L,j as e,n as l,s as o,t as m,v as b,a2 as x,w as N,L as E,N as u,be as k,o as R,B as S}from"./index-B1iCb0U8.js";import{E as T,l as D,u as F,a as q,P as A}from"./index-U0guwLQb.js";import{A as B}from"./arrow-left-DHJeeuOn.js";import{S as V}from"./shield-DjyqvyHP.js";import"./index-Ck0Sj8wK.js";const Z={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_STRIPE_PRICE_PRO:"price_1SJ813GwNQ3ybqXegEksLArF",VITE_STRIPE_PUBLIC_KEY:"pk_live_51RgqaaGwNQ3ybqXe7zIfJAb9ZLficTZSYtkJWhNV8wdD5DeZ4kgtM8tQG389FbLTSh9TZBtjou775mrxgpBCu7HV00yvoDNqW2"},C=D("pk_live_51RgqaaGwNQ3ybqXe7zIfJAb9ZLficTZSYtkJWhNV8wdD5DeZ4kgtM8tQG389FbLTSh9TZBtjou775mrxgpBCu7HV00yvoDNqW2");function Q({planId:d}){const t=F(),r=q(),{toast:c}=_(),[,p]=P(),[i,n]=y.useState(!1),h=async s=>{if(s.preventDefault(),!(!t||!r)){n(!0);try{const{error:a}=await t.confirmPayment({elements:r,confirmParams:{return_url:`${window.location.origin}/subscription?payment=success`}});a&&c({title:"Payment Failed",description:a.message,variant:"destructive"})}catch(a){c({title:"Payment Error",description:a.message||"An unexpected error occurred",variant:"destructive"})}finally{n(!1)}}};return e.jsxs("form",{onSubmit:h,className:"space-y-6",children:[e.jsx(A,{}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(S,{type:"button",variant:"outline",onClick:()=>p("/subscription"),className:"flex-1","data-testid":"button-back",children:[e.jsx(B,{className:"w-4 h-4 mr-2"}),"Back"]}),e.jsx(S,{type:"submit",disabled:!t||i,className:"flex-1 bg-white dark:bg-gray-900","data-testid":"button-submit-payment",children:i?e.jsxs(e.Fragment,{children:[e.jsx(E,{className:"w-4 h-4 mr-2"}),"Processing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(k,{className:"w-4 h-4 mr-2"}),"Subscribe Now"]})})]}),e.jsxs("div",{className:"flex items-center justify-center gap-2 text-sm text-muted-foreground",children:[e.jsx(V,{className:"w-4 h-4"}),e.jsx("span",{children:"Secured by Stripe â€¢ Cancel anytime"})]})]})}function W(){const[,d]=I("/checkout/:planId"),t=d==null?void 0:d.planId,[,r]=P(),[c,p]=y.useState(""),{toast:i}=_(),{data:n,isLoading:h}=L({queryKey:["/api/subscription/plans"],enabled:!!t}),s=n==null?void 0:n.find(a=>a.id===t);return y.useEffect(()=>{if(!t){i({title:"Invalid Plan",description:"No plan selected. Redirecting to subscription page.",variant:"destructive"}),r("/subscription");return}s&&(async()=>{var v,w;try{const j=Z[`VITE_STRIPE_PRICE_${(v=s==null?void 0:s.name)==null?void 0:v.toUpperCase()}`]||`price_${(w=s==null?void 0:s.name)==null?void 0:w.toLowerCase()}`,f=await R("POST","/api/subscription/create-subscription",{planId:t,priceId:j});if(f.ok){const g=await f.json();p(g.clientSecret)}else{const g=await f.json();i({title:"Setup Failed",description:g.message||"Failed to setup payment",variant:"destructive"}),r("/subscription")}}catch(j){i({title:"Error",description:j.message||"An error occurred",variant:"destructive"}),r("/subscription")}})()},[t,s]),C?h||!s?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-orange-50 dark:bg-orange-900/20",children:e.jsxs(l,{className:"w-full max-w-2xl",children:[e.jsxs(o,{children:[e.jsx(x,{className:"h-8 w-48"}),e.jsx(x,{className:"h-4 w-full"})]}),e.jsxs(N,{className:"space-y-4",children:[e.jsx(x,{className:"h-40 w-full"}),e.jsx(x,{className:"h-12 w-full"})]})]})}):c?e.jsx("div",{className:"min-h-screen bg-orange-50 dark:bg-orange-900/20 py-12 px-4",children:e.jsxs("div",{className:"container max-w-2xl mx-auto space-y-6",children:[e.jsxs(l,{className:"border-0 shadow-2xl",children:[e.jsxs(o,{children:[e.jsxs(m,{className:"text-2xl flex items-center gap-2",children:[e.jsx(u,{className:"w-6 h-6 text-green-500"}),"Subscribe to ",s.displayName]}),e.jsx(b,{children:s.description})]}),e.jsxs(N,{children:[e.jsxs("div",{className:"flex items-baseline justify-between mb-6 p-6 bg-white dark:bg-gray-900 rounded-xl",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-muted-foreground mb-1",children:"Monthly Subscription"}),e.jsxs("div",{className:"text-4xl font-bold text-foreground",children:["$",parseFloat(s.priceUsd).toFixed(2)]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm text-muted-foreground mb-1",children:"AI Chats Included"}),e.jsx("div",{className:"text-3xl font-bold text-primary",children:s.aiChatLimit})]})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(u,{className:"w-4 h-4 text-green-500"}),e.jsx("span",{children:"Cancel anytime, no commitments"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(u,{className:"w-4 h-4 text-green-500"}),e.jsx("span",{children:"Instant activation after payment"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(u,{className:"w-4 h-4 text-green-500"}),e.jsx("span",{children:"Secure payment processing by Stripe"})]})]})]})]}),e.jsxs(l,{className:"border-0 shadow-2xl",children:[e.jsxs(o,{children:[e.jsxs(m,{className:"flex items-center gap-2",children:[e.jsx(k,{className:"w-5 h-5"}),"Payment Details"]}),e.jsx(b,{children:"Enter your payment information to complete subscription"})]}),e.jsx(N,{children:e.jsx(T,{stripe:C,options:{clientSecret:c,appearance:{theme:"stripe",variables:{colorPrimary:"#f97316"}}},children:e.jsx(Q,{planId:t})})})]})]})}):e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-orange-50 dark:bg-orange-900/20",children:e.jsx(l,{className:"w-full max-w-2xl",children:e.jsx(o,{children:e.jsxs(m,{className:"flex items-center gap-2",children:[e.jsx(E,{className:"w-5 h-5"}),"Setting up your subscription..."]})})})}):e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-orange-50 dark:bg-orange-900/20",children:e.jsx(l,{className:"max-w-md",children:e.jsxs(o,{children:[e.jsx(m,{className:"text-red-600",children:"Payment Unavailable"}),e.jsx(b,{children:"Stripe is not configured. Please contact support."})]})})})}export{W as default};
