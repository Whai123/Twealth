import{a0 as B,a as P,r as U,g as p,h as q,j as e,ai as h,n as i,s as n,t as c,w as o,v as N,I as k,B as y,x as D,ab as I,S as Y,ax as K,a4 as O,q as G,o as Z,Y as H,Z as Q,_ as z,E as J}from"./index-B1iCb0U8.js";import{B as C}from"./badge-BLQt1mrv.js";import{R as W}from"./rocket-CyseJzex.js";import{G as x}from"./gift-DaYAbzLt.js";import{Z as _}from"./zap-Dg1ivvH7.js";import{S as R}from"./share-2-DgAeCUTh.js";import{C as V}from"./copy-BNMDfCm1.js";import{A as X}from"./award-CtYuvMv3.js";import{f as T}from"./format-BI6KV3YQ.js";import"./startOfWeek-D6dzzDOw.js";function me(){const{t:a}=B(),{toast:u}=P(),[m,v]=U.useState(""),{data:d,isLoading:A}=p({queryKey:["/api/referrals/my-code"]}),{data:l=[],isLoading:S}=p({queryKey:["/api/referrals/my-referrals"]}),{data:t,isLoading:E}=p({queryKey:["/api/referrals/bonus-credits"]}),b=q({mutationFn:async s=>await(await Z("POST","/api/referrals/use-code",{referralCode:s})).json(),onSuccess:s=>{u({title:a("referrals.success"),description:s.message}),G.invalidateQueries({queryKey:["/api/referrals/bonus-credits"]}),v("")},onError:s=>{let r="An error occurred";if(s!=null&&s.message){const j=s.message.match(/^\d+:\s*(.+)$/);if(j)try{r=JSON.parse(j[1]).message||r}catch{r=j[1]}else r=s.message}u({title:a("referrals.error"),description:r,variant:"destructive"})}}),w=async s=>{try{await navigator.clipboard.writeText(s),u({title:a("referrals.copied"),description:a("referrals.copiedDescription")})}catch(r){console.error("Failed to copy: ",r)}},L=async()=>{if(!d)return;const s={title:a("referrals.shareTitle"),text:a("referrals.shareText",{code:d.code}),url:`${window.location.origin}?ref=${d.code}`};try{navigator.share?await navigator.share(s):await w(`${s.text} ${s.url}`)}catch(r){console.error("Error sharing:",r)}},$=()=>{m.trim()&&b.mutate(m.trim())};if(A||S||E)return e.jsx("div",{className:"w-full px-4 sm:px-6 lg:px-8 xl:px-12 py-8 space-y-6","data-testid":"page-referrals",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"h-8 bg-gray-200 dark:bg-gray-700 rounded w-1/3"}),e.jsx("div",{className:"h-32 bg-gray-200 dark:bg-gray-700 rounded"}),e.jsx("div",{className:"h-32 bg-gray-200 dark:bg-gray-700 rounded"})]})});const g=Math.floor(l.length/5)+1,F=g*5-l.length,M=l.length%5/5*100,f=(s=>s>=10?{icon:H,color:"text-blue-600",bg:"bg-blue-100 dark:bg-blue-900/20",title:"Referral Royalty"}:s>=7?{icon:Q,color:"text-yellow-600",bg:"bg-yellow-100 dark:bg-yellow-900/20",title:"Referral Champion"}:s>=4?{icon:z,color:"text-blue-600",bg:"bg-blue-100 dark:bg-blue-900/20",title:"Referral Expert"}:s>=2?{icon:X,color:"text-green-600",bg:"bg-green-100 dark:bg-green-900/20",title:"Referral Pro"}:{icon:J,color:"text-orange-600",bg:"bg-orange-100 dark:bg-orange-900/20",title:"Referral Starter"})(g);return e.jsxs(e.Fragment,{children:[e.jsx("header",{className:"bg-blue-50 dark:bg-blue-900/30 border-b border-border/50",children:e.jsx("div",{className:"w-full px-4 sm:px-6 lg:px-8 xl:px-12 py-6 md:py-8",children:e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsx("div",{className:"w-16 h-16 bg-white dark:bg-gray-900 rounded-2xl flex items-center justify-center shadow-xl",children:e.jsx(h,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-4xl font-bold text-blue-600 dark:text-blue-400","data-testid":"heading-referrals",children:"Referral Rewards"}),e.jsx("p",{className:"text-xl text-muted-foreground",children:"Share the wealth, grow together!"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm rounded-xl p-4 border border-white/20",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(f.icon,{className:`w-5 h-5 ${f.color}`}),e.jsx("span",{className:"text-sm font-medium",children:"Current Level"})]}),e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:g}),e.jsx("div",{className:"text-xs text-muted-foreground",children:f.title})]}),e.jsxs("div",{className:"bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm rounded-xl p-4 border border-white/20",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(W,{className:"w-5 h-5 text-green-500"}),e.jsx("span",{className:"text-sm font-medium",children:"Total Referrals"})]}),e.jsx("div",{className:"text-2xl font-bold text-green-600",children:l.length}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Friends joined"})]}),e.jsxs("div",{className:"bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm rounded-xl p-4 border border-white/20",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(x,{className:"w-5 h-5 text-orange-500"}),e.jsx("span",{className:"text-sm font-medium",children:"Total Earned"})]}),e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:(t==null?void 0:t.credits.reduce((s,r)=>s+r.amount,0))||0}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Bonus credits"})]}),e.jsxs("div",{className:"bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm rounded-xl p-4 border border-white/20",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(_,{className:"w-5 h-5 text-blue-500"}),e.jsx("span",{className:"text-sm font-medium",children:"Available"})]}),e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:(t==null?void 0:t.availableAmount)||0}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Ready to use"})]})]}),e.jsxs("div",{className:"mt-6 bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm rounded-xl p-4 border border-white/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"text-sm font-medium",children:["Progress to Level ",g+1]}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[F," more referrals needed"]})]}),e.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-3",children:e.jsx("div",{className:"bg-white dark:bg-gray-900 h-3 rounded-full relative",style:{width:`${M}%`},children:e.jsx("div",{className:"absolute right-0 top-0 h-full w-2 bg-white/30 rounded-full"})})})]})]})})})}),e.jsxs("div",{className:"w-full px-4 sm:px-6 lg:px-8 xl:px-12 py-6 md:py-8 space-y-6","data-testid":"page-referrals",children:[t&&e.jsxs(i,{className:"bg-green-50 dark:bg-green-900/20 border-green-200/50 dark:border-green-700/50 shadow-lg transition-all","data-testid":"card-bonus-credits",children:[e.jsxs(n,{className:"pb-4",children:[e.jsxs(c,{className:"text-xl font-bold text-foreground flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-white dark:bg-gray-900 rounded-lg flex items-center justify-center",children:e.jsx(x,{className:"h-5 w-5 text-white"})}),"Your Treasure Chest"]}),e.jsx("p",{className:"text-muted-foreground",children:"Credits earned through referrals"})]}),e.jsx(o,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-5xl font-bold text-foreground mb-2","data-testid":"text-available-credits",children:t.availableAmount}),e.jsx("p",{className:"text-lg font-semibold text-green-700 dark:text-green-300",children:"Available Credits"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Ready to spend!"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-emerald-600 mb-2",children:t.credits.reduce((s,r)=>s+r.amount,0)}),e.jsx("p",{className:"text-lg font-semibold text-emerald-700 dark:text-emerald-300",children:"Total Earned"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"All time rewards"})]})]})})]}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsxs(i,{className:"bg-blue-50 dark:bg-blue-900/20 border-blue-200/50 dark:border-blue-700/50 shadow-lg transition-all","data-testid":"card-my-code",children:[e.jsxs(n,{className:"pb-4",children:[e.jsxs(c,{className:"text-xl font-bold text-foreground flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-white dark:bg-gray-900 rounded-lg flex items-center justify-center",children:e.jsx(R,{className:"h-5 w-5 text-white"})}),"Your Magic Code"]}),e.jsx(N,{className:"text-base",children:"Share this special code and earn rewards together!"})]}),e.jsx(o,{className:"space-y-4",children:d&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative",children:[e.jsx(k,{value:d.code,readOnly:!0,className:"font-mono text-xl text-center bg-white dark:bg-gray-900 border-2 border-blue-200 dark:border-blue-700 h-14 text-blue-800 dark:text-blue-200 font-bold","data-testid":"input-referral-code"}),e.jsx(y,{variant:"ghost",size:"icon",onClick:()=>w(d.code),className:"absolute right-2 top-1/2 -translate-y-1/2 hover:bg-blue-100 dark:hover:bg-blue-800","data-testid":"button-copy-code",children:e.jsx(V,{className:"h-5 w-5 text-blue-600"})})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white/50 dark:bg-gray-800/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(D,{className:"h-4 w-4 text-blue-600"}),e.jsxs("span",{className:"text-sm font-medium","data-testid":"text-uses",children:["Used: ",d.currentUses,"/",d.maxUses]})]}),e.jsx(C,{variant:d.isActive?"default":"secondary",className:"bg-green-100 text-green-800 border-green-300",children:d.isActive?"Active":"Inactive"})]}),e.jsxs(y,{onClick:L,className:"w-full bg-primary text-primary-foreground font-semibold py-3 h-12 shadow-lg","data-testid":"button-share-code",children:[e.jsx(R,{className:"h-5 w-5 mr-2"}),"Share & Earn Together"]})]})})]}),e.jsxs(i,{className:"bg-orange-50 dark:bg-orange-900/20 border-orange-200/50 dark:border-orange-700/50 shadow-lg transition-all","data-testid":"card-use-code",children:[e.jsxs(n,{className:"pb-4",children:[e.jsxs(c,{className:"text-xl font-bold text-foreground flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-white dark:bg-gray-900 rounded-lg flex items-center justify-center",children:e.jsx(x,{className:"h-5 w-5 text-white"})}),"Redeem Invitation"]}),e.jsx(N,{className:"text-base",children:"Got a friend's code? Claim your bonus here!"})]}),e.jsxs(o,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{htmlFor:"referral-code",className:"text-sm font-semibold",children:"Enter Your Friend's Code"}),e.jsx(k,{id:"referral-code",placeholder:"TYPE-FRIEND-CODE",value:m,onChange:s=>v(s.target.value.toUpperCase()),className:"font-mono text-lg text-center bg-white dark:bg-gray-900 border-2 border-orange-200 dark:border-orange-700 h-12 text-orange-800 dark:text-orange-200 font-bold","data-testid":"input-use-code"})]}),e.jsx(y,{onClick:$,disabled:!m.trim()||b.isPending,className:"w-full bg-primary text-primary-foreground font-semibold py-3 h-12 shadow-lg disabled:opacity-50 disabled: disabled:hover:translate-y-0","data-testid":"button-use-code",children:b.isPending?e.jsxs(e.Fragment,{children:[e.jsx(Y,{className:"h-5 w-5 mr-2"}),"Processing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(x,{className:"h-5 w-5 mr-2"}),"Claim Bonus Now"]})}),e.jsxs("div",{className:"flex items-start gap-3 p-4 bg-orange-100 dark:bg-orange-900/20 rounded-xl border border-orange-200/50 dark:border-orange-700/50",children:[e.jsx("div",{className:"w-6 h-6 bg-white dark:bg-gray-900 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5",children:e.jsx(K,{className:"h-3 w-3 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-orange-800 dark:text-orange-200 mb-1",children:"Free Bonus Waiting!"}),e.jsx("p",{className:"text-xs text-orange-700 dark:text-orange-300",children:"Use a friend's code to get instant bonus credits - completely free!"})]})]})]})]})]}),e.jsxs(i,{"data-testid":"card-referral-history",children:[e.jsxs(n,{children:[e.jsxs(c,{className:"flex items-center gap-2",children:[e.jsx(h,{className:"h-5 w-5"}),a("referrals.history")]}),e.jsx(N,{children:a("referrals.historyDescription")})]}),e.jsx(o,{children:l.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground","data-testid":"text-no-referrals",children:[e.jsx(h,{className:"h-12 w-12 mx-auto mb-4 opacity-20"}),e.jsx("p",{children:a("referrals.noReferrals")}),e.jsx("p",{className:"text-sm mt-2",children:a("referrals.startSharing")})]}):e.jsx("div",{className:"space-y-2",children:l.map((s,r)=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-8 w-8 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx(h,{className:"h-4 w-4 text-primary"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium","data-testid":`text-referred-user-${r}`,children:[s.referredUserName||a("referrals.friend")," #",r+1]}),e.jsx("p",{className:"text-sm text-muted-foreground","data-testid":`text-referral-date-${r}`,children:T(new Date(s.createdAt),"MMM dd, yyyy")})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(C,{variant:"secondary",children:["+10 ",a("referrals.credits")]}),e.jsx(O,{className:"h-4 w-4 text-muted-foreground"})]})]},s.id))})})]}),t&&t.credits.length>0&&e.jsxs(i,{"data-testid":"card-credits-history",children:[e.jsx(n,{children:e.jsxs(c,{className:"flex items-center gap-2",children:[e.jsx(x,{className:"h-5 w-5"}),a("referrals.creditsHistory")]})}),e.jsx(o,{children:e.jsx("div",{className:"space-y-2",children:t.credits.map((s,r)=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium","data-testid":`text-credit-description-${r}`,children:s.description}),e.jsx("p",{className:"text-sm text-muted-foreground","data-testid":`text-credit-date-${r}`,children:T(new Date(s.createdAt),"MMM dd, yyyy")})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-bold text-green-600","data-testid":`text-credit-amount-${r}`,children:["+",s.amount]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[a("referrals.used"),": ",s.usedAmount]})]})]},s.id))})})]})]})]})}export{me as default};
