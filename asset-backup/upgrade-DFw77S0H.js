import{r as p,j as e,H as j,_ as F,p as O,q as Z,a6 as D,y as P,z as S,E as y,B as C,O as G,V as _,I as Y,a7 as z}from"./index-NNgTI0RQ.js";import{u as V,a as W,d as H,E as J,l as X}from"./react-stripe.esm-BHTGQQV3.js";import{B as f}from"./badge-D7Q8E7hz.js";import{A as ee,a as te}from"./alert-BWRao83W.js";import{A as q}from"./arrow-left-CwkJQlvl.js";import{S as A}from"./sparkles-yxnOzOhM.js";import{Z as se}from"./zap-jVm97dbR.js";import"./index-hdTjj1pu.js";function ae({onSuccess:l,onError:r}){const o=V(),c=W(),[m,d]=p.useState(!1),[x,i]=p.useState(null),g=async v=>{if(v.preventDefault(),i(null),!o||!c){i("Payment system not initialized");return}d(!0);try{const{error:n}=await c.submit();if(n){i(n.message||"Failed to submit payment information"),d(!1);return}const{error:u}=await o.confirmPayment({elements:c,confirmParams:{return_url:window.location.origin+"/subscription"},redirect:"if_required"});u?(i(u.message||"Payment failed"),r(u.message||"Payment failed")):l()}catch(n){i(n.message||"An unexpected error occurred"),r(n.message||"An unexpected error occurred")}finally{d(!1)}};return e.jsxs("form",{onSubmit:g,className:"space-y-6",children:[e.jsx("div",{className:"bg-gray-50 dark:bg-gray-900/50 p-4 rounded-lg",children:e.jsx(H,{options:{layout:"tabs",paymentMethodOrder:["card"]}})}),x&&e.jsx(ee,{variant:"destructive","data-testid":"alert-payment-error",children:e.jsx(te,{children:x})}),e.jsx(j,{type:"submit",className:"w-full",disabled:!o||!c||m,"data-testid":"button-complete-payment",children:m?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(F,{className:"w-4 h-4"}),"Processing Payment..."]}):"Complete Payment"}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 text-center",children:"Your payment information is encrypted and secure. We never store your payment details."})]})}const k=X("pk_live_51RgqaaGwNQ3ybqXe7zIfJAb9ZLficTZSYtkJWhNV8wdD5DeZ4kgtM8tQG389FbLTSh9TZBtjou775mrxgpBCu7HV00yvoDNqW2");function ue(){const[,l]=O(),{toast:r}=Z(),[o,c]=p.useState(null),[m,d]=p.useState(null),[x,i]=p.useState("upgrade"),{formatAmount:g,convertFromUSD:v}=D(),{data:n=[],isLoading:u}=P({queryKey:["/api/subscription/plans"]}),{data:N}=P({queryKey:["/api/subscription/current"]}),w=S({mutationFn:async t=>(await C("POST","/api/subscription/upgrade",{planId:t})).json(),onSuccess:t=>{var s,a;if(t.requiresPayment){if(!k){r({title:"Payment Not Available",description:"Payment processing is being set up. Please try again later or contact support.",variant:"destructive"});return}r({title:"Payment Required",description:"Redirecting to payment..."}),h.mutate(o)}else r({title:"Plan Updated",description:`You're now on ${(a=(s=t.subscription)==null?void 0:s.plan)==null?void 0:a.displayName}`}),y.invalidateQueries({queryKey:["/api/subscription/current"]}),y.invalidateQueries({queryKey:["/api/subscription/usage"]}),l("/subscription")},onError:t=>{r({title:"Upgrade Failed",description:t.message,variant:"destructive"})}}),h=S({mutationFn:async t=>(await C("POST","/api/subscription/create-payment-intent",{planId:t})).json(),onSuccess:t=>{if(t.requiresSetup){r({title:"Payment Setup Required",description:"Payment processing is not configured. Contact support.",variant:"destructive"});return}d(t.clientSecret),i("payment")},onError:t=>{r({title:"Payment Setup Failed",description:t.message,variant:"destructive"})}}),U=t=>{c(t);const s=n.find(a=>a.id===t);(s==null?void 0:s.name)==="free"||parseFloat((s==null?void 0:s.priceUsd)||"0")===0?w.mutate(t):k?h.mutate(t):r({title:"Payment Not Available",description:"Payment processing is being set up. Please try again later or contact support.",variant:"destructive"})},E=t=>{switch(t){case"free":return e.jsx(A,{className:"w-5 h-5"});case"pro":return e.jsx(z,{className:"w-5 h-5"});case"enterprise":return e.jsx(se,{className:"w-5 h-5"});default:return e.jsx(A,{className:"w-5 h-5"})}},L=(t,s)=>{const a=parseFloat(t||"0");return isNaN(a)||a===0?{amount:g(0),period:"forever"}:{amount:g(v(a)),period:`/${s==="monthly"?"mo":s}`}},B=t=>{var s;return((s=N==null?void 0:N.subscription)==null?void 0:s.planId)===t},T=t=>{const s=[];return t.name==="free"?(s.push("50 Scout AI queries/month"),s.push("Basic financial tracking"),s.push("Up to 3 financial goals"),s.push("30-day transaction history")):t.name==="pro"?(s.push("Unlimited Scout AI queries"),s.push("25 Sonnet reasoning queries/month"),s.push("5 GPT-5 math queries/month"),s.push("Unlimited goals & history"),s.push("Crypto portfolio tracking"),s.push("Advanced analytics")):t.name==="enterprise"&&(s.push("Everything in Pro, plus:"),s.push("60 Sonnet reasoning/month"),s.push("10 GPT-5 math/month"),s.push("20 Opus CFO queries/month"),s.push("Team collaboration"),s.push("API access")),s},$=[...n].sort((t,s)=>{const a={free:0,pro:1,enterprise:2};return(a[t.name]||0)-(a[s.name]||0)});return x==="payment"&&m&&k?e.jsx("div",{className:"min-h-screen bg-white dark:bg-black",children:e.jsxs("div",{className:"max-w-md mx-auto px-6 py-12",children:[e.jsxs(j,{variant:"ghost",onClick:()=>{i("upgrade"),d(null)},className:"mb-8","data-testid":"button-back",children:[e.jsx(q,{className:"w-4 h-4 mr-2"}),"Back to plans"]}),e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h1",{className:"text-2xl font-bold text-black dark:text-white mb-2",children:"Complete Payment"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Secure payment powered by Stripe"})]}),e.jsx(G,{className:"border border-gray-200 dark:border-gray-800",children:e.jsx(_,{className:"p-6",children:e.jsx(J,{stripe:k,options:{clientSecret:m,appearance:{theme:"stripe",variables:{colorPrimary:"#000000",colorBackground:"#ffffff",colorText:"#000000",fontFamily:'"Inter", system-ui, sans-serif',borderRadius:"8px"}}},children:e.jsx(ae,{onSuccess:()=>{r({title:"Payment Successful",description:"Your subscription has been upgraded."}),y.invalidateQueries({queryKey:["/api/subscription/current"]}),y.invalidateQueries({queryKey:["/api/subscription/usage"]}),l("/subscription")},onError:t=>{r({title:"Payment Failed",description:t,variant:"destructive"})}})})})})]})}):e.jsxs("div",{className:"min-h-screen bg-white dark:bg-black",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-gray-50 to-white dark:from-gray-950 dark:to-black"}),e.jsxs("div",{className:"relative",children:[e.jsx("header",{className:"max-w-6xl mx-auto px-6 py-6",children:e.jsxs(j,{variant:"ghost",onClick:()=>l("/subscription"),className:"text-gray-600 dark:text-gray-400 hover:text-black dark:hover:text-white","data-testid":"button-back-subscription",children:[e.jsx(q,{className:"w-4 h-4 mr-2"}),"Back to subscription"]})}),e.jsxs("div",{className:"max-w-6xl mx-auto px-6 pb-20",children:[e.jsxs("div",{className:"text-center mb-12",children:[e.jsx(f,{variant:"outline",className:"mb-6 px-4 py-1.5 text-sm font-medium border-gray-200 dark:border-gray-800",children:"Upgrade"}),e.jsx("h1",{className:"text-4xl sm:text-5xl font-bold tracking-tight text-black dark:text-white mb-4",children:"Choose your plan"}),e.jsx("p",{className:"text-lg text-gray-600 dark:text-gray-400 max-w-xl mx-auto",children:"Unlock AI-powered financial insights and advanced features"})]}),u?e.jsx("div",{className:"grid md:grid-cols-3 gap-8 max-w-5xl mx-auto",children:[1,2,3].map(t=>e.jsx("div",{className:"h-[450px] bg-gray-100 dark:bg-gray-900 rounded-2xl animate-pulse"},t))}):e.jsx("div",{className:"grid md:grid-cols-3 gap-8 max-w-5xl mx-auto",children:$.map(t=>{const s=t.name==="pro",a=t.name==="enterprise",b=B(t.id),{amount:M,period:I}=L(t.priceUsd,t.billingInterval),Q=T(t);return e.jsxs("div",{className:`relative rounded-2xl p-8 ${s?"border-2 border-black dark:border-white bg-gray-50 dark:bg-gray-950":"border border-gray-200 dark:border-gray-800"} ${b?"ring-2 ring-green-500":""}`,"data-testid":`card-plan-${t.name.toLowerCase()}`,children:[s&&e.jsx(f,{className:"absolute -top-3 left-1/2 -translate-x-1/2 bg-black dark:bg-white text-white dark:text-black px-4 py-1 text-xs font-medium",children:"Most Popular"}),a&&e.jsx(f,{className:"absolute -top-3 left-1/2 -translate-x-1/2 bg-gradient-to-r from-amber-500 to-yellow-600 text-white px-4 py-1 text-xs font-medium",children:"Best for Teams"}),b&&e.jsx(f,{className:"absolute -top-3 right-4 bg-green-500 text-white px-3 py-1 text-xs font-medium",children:"Current"}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("div",{className:`w-10 h-10 rounded-xl flex items-center justify-center ${s?"bg-blue-100 dark:bg-blue-950 text-blue-600 dark:text-blue-400":a?"bg-amber-100 dark:bg-amber-950 text-amber-600 dark:text-amber-400":"bg-gray-100 dark:bg-gray-900 text-gray-600 dark:text-gray-400"}`,children:E(t.name)}),e.jsx("h2",{className:"text-xl font-semibold text-black dark:text-white",children:t.displayName})]}),e.jsxs("div",{className:"flex items-baseline gap-1 mb-6",children:[e.jsx("span",{className:"text-4xl font-bold text-black dark:text-white",children:M}),e.jsx("span",{className:"text-gray-500",children:I})]}),e.jsx(j,{className:`w-full h-12 font-medium rounded-xl ${s?"bg-black dark:bg-white text-white dark:text-black hover:bg-gray-800 dark:hover:bg-gray-200":"bg-gray-100 dark:bg-gray-900 text-black dark:text-white hover:bg-gray-200 dark:hover:bg-gray-800"}`,onClick:()=>U(t.id),disabled:b||w.isPending||h.isPending,"data-testid":`button-upgrade-${t.name.toLowerCase()}`,children:(w.isPending||h.isPending)&&o===t.id?e.jsxs(e.Fragment,{children:[e.jsx(F,{className:"w-4 h-4 mr-2 animate-spin"}),"Processing..."]}):b?"Current plan":parseFloat(t.priceUsd)===0?"Get started":`Upgrade to ${t.name}`})]}),e.jsx("div",{className:"space-y-3",children:Q.map((R,K)=>e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Y,{className:"w-4 h-4 text-black dark:text-white flex-shrink-0 mt-0.5"}),e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:R})]},K))})]},t.id)})}),e.jsx("div",{className:"text-center mt-12",children:e.jsx("p",{className:"text-sm text-gray-500",children:"Secure payments powered by Stripe. Cancel anytime."})})]})]})]})}export{ue as default};
