import{p as S,r as l,y as k,z as T,E as M,B as I,K as $,j as e,X as A,H as y,ad as E}from"./index-NNgTI0RQ.js";import{c as x}from"./confetti.module-B5JVzsfH.js";import{T as G}from"./trophy-DkSOE-LA.js";import{S as L}from"./sparkles-yxnOzOhM.js";import{S as Q}from"./star-DAdPyuou.js";import{A as q}from"./index-BV8oB33o.js";import{m as s}from"./proxy-C8xz_zGI.js";const w={25:{title:"Quarter Way There",subtitle:"You've reached 25% of your goal. Great momentum!",icon:Q},50:{title:"Halfway Champion",subtitle:"50% complete! You're crushing this goal.",icon:$},75:{title:"Almost There",subtitle:"75% done! The finish line is in sight.",icon:L},100:{title:"Goal Achieved",subtitle:"Congratulations! You've reached your target.",icon:G}},v={25:{bg:"from-blue-500 to-blue-600",border:"border-blue-400",text:"text-blue-50"},50:{bg:"from-violet-500 to-purple-600",border:"border-violet-400",text:"text-violet-50"},75:{bg:"from-amber-500 to-orange-600",border:"border-amber-400",text:"text-amber-50"},100:{bg:"from-emerald-500 to-green-600",border:"border-emerald-400",text:"text-emerald-50"}};function F(n){const a=n/100;x({particleCount:Math.floor(100*a),spread:70+n/4,origin:{y:.6},colors:n===100?["#ffd700","#22c55e","#3b82f6","#f59e0b"]:["#3b82f6","#8b5cf6","#f59e0b"]}),n===100&&setTimeout(()=>{x({particleCount:50,angle:60,spread:55,origin:{x:0},colors:["#ffd700","#22c55e"]}),x({particleCount:50,angle:120,spread:55,origin:{x:1},colors:["#ffd700","#22c55e"]})},250)}function V(){const[,n]=S(),[a,d]=l.useState([]),[m,u]=l.useState(!1),[b,g]=l.useState([]),{data:r=[]}=k({queryKey:["/api/goal-milestones"],staleTime:1e3*10,refetchInterval:1e3*30}),j=T({mutationFn:async()=>{await I("POST","/api/goal-milestones/mark-seen")},onSuccess:()=>{M.invalidateQueries({queryKey:["/api/goal-milestones"]}),g([])},onError:()=>{d(i=>[...r.filter(p=>b.includes(p.id)),...i]),u(!0)}});l.useEffect(()=>{if(r.length>0){const i=r.filter(o=>!a.some(p=>p.id===o.id)&&!b.includes(o.id));i.length>0&&(d(o=>[...o,...i]),u(!0))}},[r]);const t=a[0];l.useEffect(()=>{t&&m&&F(t.milestone)},[t==null?void 0:t.id,m]);const c=()=>{t&&(g(i=>[...i,t.id]),d(i=>i.slice(1)),a.length<=1&&(u(!1),j.mutate()))},N=()=>{t&&(n(`/financial-goals?highlight=${t.goalId}`),c())};if(!a.length||!m||!t)return null;const h=w[t.milestone]||w[25],f=v[t.milestone]||v[25],C=h.icon;return e.jsx(q,{children:e.jsx(s.div,{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:c,"data-testid":"milestone-celebration-overlay",children:e.jsxs(s.div,{className:`relative max-w-md w-full mx-4 rounded-3xl bg-gradient-to-br ${f.bg} p-8 shadow-2xl border ${f.border}`,initial:{scale:.8,y:50,opacity:0},animate:{scale:1,y:0,opacity:1},exit:{scale:.8,y:50,opacity:0},transition:{type:"spring",damping:20,stiffness:300},onClick:i=>i.stopPropagation(),"data-testid":"milestone-celebration-card",children:[e.jsx("button",{onClick:c,className:"absolute top-4 right-4 p-2 rounded-full hover:bg-white/20 transition-colors","data-testid":"button-dismiss-milestone",children:e.jsx(A,{className:"w-5 h-5 text-white/80"})}),e.jsxs("div",{className:"text-center",children:[e.jsx(s.div,{className:"w-20 h-20 mx-auto mb-6 rounded-full bg-white/20 flex items-center justify-center",animate:{scale:[1,1.1,1],rotate:[0,5,-5,0]},transition:{duration:2,repeat:1/0,repeatType:"reverse"},children:e.jsx(C,{className:"w-10 h-10 text-white"})}),e.jsxs(s.div,{className:"mb-2 text-white/80 text-sm font-medium uppercase tracking-wider",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.2},children:[t.milestone,"% Milestone"]}),e.jsx(s.h2,{className:"text-3xl font-bold text-white mb-2",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.3},children:h.title}),e.jsx(s.p,{className:`${f.text} mb-4`,initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.4},children:h.subtitle}),e.jsxs(s.div,{className:"bg-white/20 rounded-xl p-4 mb-6",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.5},children:[e.jsxs("p",{className:"text-white/80 text-sm mb-1",children:["Goal: ",t.goal.title]}),e.jsxs("p",{className:"text-2xl font-bold text-white",children:["$",parseFloat(t.amountAtMilestone).toLocaleString(),e.jsxs("span",{className:"text-white/60 text-lg font-normal",children:[" ","/ $",parseFloat(t.goal.targetAmount).toLocaleString()]})]})]}),e.jsxs(s.div,{className:"flex gap-3",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.6},children:[e.jsx(y,{variant:"outline",className:"flex-1 bg-white/20 border-white/30 text-white hover:bg-white/30 hover:text-white",onClick:c,"data-testid":"button-continue",children:a.length>1?"Next":"Continue"}),e.jsxs(y,{className:"flex-1 bg-white text-gray-900 hover:bg-white/90",onClick:N,"data-testid":"button-view-goal",children:["View Goal",e.jsx(E,{className:"w-4 h-4 ml-1"})]})]}),a.length>1&&e.jsx(s.div,{className:"mt-4 flex justify-center gap-2",initial:{opacity:0},animate:{opacity:1},transition:{delay:.7},children:a.map((i,o)=>e.jsx("div",{className:`w-2 h-2 rounded-full transition-colors ${o===0?"bg-white":"bg-white/30"}`},o))})]})]})})})}export{V as MilestoneCelebration,V as default};
